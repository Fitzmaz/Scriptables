var Scriptable;(()=>{var t={418:t=>{const e={196:1,197:20,198:7,199:20,200:10,201:26,203:6,204:14,205:13,206:35},n={196:0,197:20,198:50,199:50,200:0,201:50,203:50,204:50,205:50,206:100};function a(t,e){return t.timestamp<e.timestamp?-1:t.timestamp>e.timestamp?1:0}class i{constructor(t,e,n){this.original=t,this.loss=e,this.remaining=n}}function r(t,e){let n=t/100,a=[];for(let t=1*e;t<=90*e;t++){let e=Math.floor(t/(n-5e-5));e==Math.ceil(t/(n+5e-5))&&a.push(new i(e,t,e-t))}return a}const o="Natural Recovery";function s(t,e,n){let i=t.filter((t=>"Rehab"!==t.title&&e<1e3*t.timestamp&&1e3*t.timestamp<n)),r=function(t){const e=16088688e5,n=864e5;return e+Math.ceil((t-e)/n)*n}(e);for(;r<n;)i.push({log:-1,title:o,timestamp:r/1e3,data:{points:r>161892e7?20:21}}),r+=864e5;return i.sort(a),i}function l(t,a){let i=a;return t.map((t=>{let a;return a=t.title===o?-Math.min(i,t.data.points):t.title.indexOf("overdose")>=0?Math.round(.5*n[t.data.item]):Math.round(.5*e[t.data.item]),i+=a,{timestamp:t.timestamp,delta:a,points:i,description:t.title}}))}function c(t){return t.map((t=>({timestamp:t.timestamp,delta:null,points:null,description:t.title})))}t.exports={createTableRows:function(t,e){let n=[];for(let a=t.length-1;a>0;a--){let o=t[a],u=t[a-1],d=1e3*o.timestamp,m=1e3*u.timestamp;if(o.timestamp<e[e.length-1].timestamp)continue;let g,p=s(e,d,m);g=100===o.data.addiction?[new i(null,null,0)]:r(o.data.addiction,o.data.rehab_times);let h=r(u.data.addiction,u.data.rehab_times),f=[];for(let t=0;t<g.length;t++)for(let e=0;e<h.length;e++){let n,a;p.length?(n=l(p,g[t].remaining),a=n[n.length-1].points):(n=[],a=g[t].remaining),a==h[e].original&&f.push({previous:g[t],current:h[e],rows:n})}f.length>1&&(console.log("ambiguous solutions:",f,"for rehab:",u),n.length>0&&null!==n[n.length-1].points?(console.log("trying to disambiguate"),f=f.filter((t=>t.previous.remaining==n[n.length-1].points&&t.previous.loss==-n[n.length-1].delta))):console.log("unable to disambiguate"),1==f.length?console.log("succeeded to disambiguate"):console.log("failed to disambiguate")),1==f.length?(n=n.concat(f[0].rows),n.push({timestamp:u.timestamp,delta:-f[0].current.loss,points:f[0].current.remaining,description:`Rehab x${u.data.rehab_times} ${u.data.addiction}%`})):(n=n.concat(c(p)),n.push({timestamp:u.timestamp,delta:null,points:null,description:`Rehab x${u.data.rehab_times} ${u.data.addiction}%`}))}let a,o=s(e,1e3*t[0].timestamp,Date.now());return a=null!=n[n.length-1].points?l(o,n[n.length-1].points):c(o),n=n.concat(a),n}}},238:t=>{t.exports={set(t,e){let n;if("number"==typeof e)n=String(e);else{if("string"!=typeof e)return;n=e}Keychain.set(t,n)},get:t=>Keychain.contains(t)?Keychain.get(t):null,remove(t){Keychain.contains(t)&&Keychain.remove(t)},setJSON(t,e){this.set(t,JSON.stringify(e))},getJSON(t){let e;try{e=JSON.parse(this.get(t))}catch(t){return null}return e}}},27:(t,e,n)=>{const a=n(238);console.log("Runtime Version: 20210708");const i=t=>async()=>{let e=new WebView;await e.loadURL(`https://fce295ndf.lightyy.com/#/settings?t=${Date.now()}`);let n=t.loadSettings();await e.evaluateJavaScript(`window.importSettings(${JSON.stringify(n)})`),await e.present();const a=await e.evaluateJavaScript("window.exportSettings()");t.saveSettings(a)},r=t=>async(e,n="")=>{let a=null;if(config.runsInWidget||config.runsWithSiri){a=new e((config.runsInWidget?args.widgetParameter:args.shortcutParameter)||"");const t=await a.render();Script.setWidget(t),Script.complete()}else{let{act:r,data:o,__arg:s,__size:l}=args.queryParameters;if(a=new e(s||n||""),l&&a.init(l),!r||!a._actions){const e=a._actions,n=[];t?n.push((t=>async()=>{let e=new Alert;e.title="é¢„è§ˆç»„ä»¶",e.message="æµ‹è¯•æ¡Œé¢ç»„ä»¶åœ¨å„ç§å°ºå¯¸ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ",e.addAction("å°å°ºå¯¸ Small"),e.addAction("ä¸­å°ºå¯¸ Medium"),e.addAction("å¤§å°ºå¯¸ Large"),e.addAction("å…¨éƒ¨ All"),e.addCancelAction("å–æ¶ˆæ“ä½œ");let n,a=await e.presentSheet();if(-1!==a){switch(a){case 0:t.widgetFamily="small",n=await t.render(),await n.presentSmall();break;case 1:t.widgetFamily="medium",n=await t.render(),await n.presentMedium();break;case 2:t.widgetFamily="large",n=await t.render(),await n.presentLarge();break;case 3:t.widgetFamily="small",n=await t.render(),await n.presentSmall(),t.widgetFamily="medium",n=await t.render(),await n.presentMedium(),t.widgetFamily="large",n=await t.render(),await n.presentLarge()}return a}})(a),(t=>async()=>{const e=globalThis.module.filename.replace("ã€Œå°ä»¶ä»¶ã€å¼€å‘ç¯å¢ƒ",Script.name()),n=FileManager.local().readString(e);Pasteboard.copyString(n),await t.notify("å¤åˆ¶æˆåŠŸ","å½“å‰è„šæœ¬çš„æºä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼")})(a),i(a)):(n.push((t=>async()=>{const e=(n=t=>async e=>{const n=new Request(e);let a;n.timeoutInterval=5,a="json"===t?await n.loadJSON():"string"===t?await n.loadString():await n.load();const{statusCode:i}=n.response;if(200!==i)throw new Error(`Failed to request ${e} with status code ${i}.`);return a},async(t,e)=>{const a=n(e);let i=await a(t).catch((t=>console.warn(`Request Failed Error:${t}`)));if(!i){const e=`https://api.tornhub.xyz:8092/v1/file/get?url=${encodeURIComponent(t)}`;console.log(`è¯·æ±‚fallback: ${e}`),i=await a(e).catch((t=>console.error(`Fallback Failed Error:${t}`)))}return i});var n;let a=t.name,i=encodeURIComponent(a);console.log("å¼€å§‹æ£€æŸ¥æ›´æ–°");let r=`https://gitee.com/Fitzmaz/Scriptables/raw/v2-dev/Dist/${i}/manifest.json?_=${Date.now()}`;const o=await e(r,"json").catch((t=>{console.error(`æ£€æŸ¥æ›´æ–°å‘ç”Ÿé”™è¯¯: ${t}`)}));if(!o)return;if(o.version==t.version)return void console.log("å½“å‰ç‰ˆæœ¬å·²ç»æ˜¯æœ€æ–°");let s=new Alert;if(s.message=`æ–°ç‰ˆæœ¬ ${o.version} æ˜¯å¦æ›´æ–°`,s.addAction("æ˜¯"),s.addAction("å¦"),1==await s.presentAlert())return;console.log("å¼€å§‹ä¸‹è½½æ›´æ–°");const l=`https://gitee.com/Fitzmaz/Scriptables/raw/v2-dev/Dist/${i}/${i}-${o.version}.js`,c=await e(l).catch((t=>{console.error(`ä¸‹è½½æ›´æ–°å‘ç”Ÿé”™è¯¯: ${t}`)}));c&&(console.log("å¼€å§‹å†™å…¥æ›´æ–°"),t.FILE_MGR.write(t.FILE_MGR.joinPath(t.FILE_MGR.documentsDirectory(),`${Script.name()}.js`),c))})(a)),n.push(i(a)));const r=new Alert;r.title=`${a.name.toUpperCase()} å°ç»„ä»¶`,r.message=a.desc,t?(r.addAction("é¢„è§ˆç»„ä»¶"),r.addAction("å¤åˆ¶æºç "),r.addAction("åå¥½è®¾ç½®")):(r.addAction("æ£€æŸ¥æ›´æ–°"),r.addAction("åå¥½è®¾ç½®"));for(let t in e)r.addAction(t),n.push(e[t]);r.addCancelAction("å–æ¶ˆæ“ä½œ");const o=await r.presentSheet();if(n[o]){const t=n[o];await t()}return}let c=`action${r.split("-").map((t=>t[0].toUpperCase()+t.substr(1))).join("")}`;if(a[c]&&"function"==typeof a[c]){const t=a[c].bind(a);await t(o)}}},o=r(!1),s=r(!0);t.exports={Base:class{constructor(t=""){this.arg=t,this.name="",this.version="",this.desc="",this._actions={},this.init()}init(t=config.widgetFamily){this.widgetFamily=t,this.SETTING_KEY=this.md5(Script.name()),this.FILE_MGR=FileManager[globalThis.module.filename.includes("Documents/iCloud~")?"iCloud":"local"](),this.FILE_MGR_LOCAL=FileManager.local(),this.BACKGROUND_KEY=this.FILE_MGR_LOCAL.joinPath(this.FILE_MGR_LOCAL.documentsDirectory(),`bg_${this.SETTING_KEY}.jpg`),this.settings=this.loadSettings()}registerAction(t,e){this._actions[t]=e.bind(this)}actionUrl(t="",e=""){let n=URLScheme.forRunningScript(),a=`act=${encodeURIComponent(t)}&data=${encodeURIComponent(e)}&__arg=${encodeURIComponent(this.arg)}&__size=${this.widgetFamily}`,i="";return i=n.includes("run?")?`${n}&${a}`:`${n}?${a}`,i}base64Encode(t){return Data.fromString(t).toBase64String()}base64Decode(t){return Data.fromBase64String(t).toRawString()}md5(t){function e(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function n(t,n,a,i,r,o){return e((s=e(e(n,t),e(i,o)))<<(l=r)|s>>>32-l,a);var s,l}function a(t,e,a,i,r,o,s){return n(e&a|~e&i,t,e,r,o,s)}function i(t,e,a,i,r,o,s){return n(e&i|a&~i,t,e,r,o,s)}function r(t,e,a,i,r,o,s){return n(e^a^i,t,e,r,o,s)}function o(t,e,a,i,r,o,s){return n(a^(e|~i),t,e,r,o,s)}function s(t,n){var s,l,c,u;t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var d=1732584193,m=-271733879,g=-1732584194,p=271733878,h=0;h<t.length;h+=16)d=a(s=d,l=m,c=g,u=p,t[h],7,-680876936),p=a(p,d,m,g,t[h+1],12,-389564586),g=a(g,p,d,m,t[h+2],17,606105819),m=a(m,g,p,d,t[h+3],22,-1044525330),d=a(d,m,g,p,t[h+4],7,-176418897),p=a(p,d,m,g,t[h+5],12,1200080426),g=a(g,p,d,m,t[h+6],17,-1473231341),m=a(m,g,p,d,t[h+7],22,-45705983),d=a(d,m,g,p,t[h+8],7,1770035416),p=a(p,d,m,g,t[h+9],12,-1958414417),g=a(g,p,d,m,t[h+10],17,-42063),m=a(m,g,p,d,t[h+11],22,-1990404162),d=a(d,m,g,p,t[h+12],7,1804603682),p=a(p,d,m,g,t[h+13],12,-40341101),g=a(g,p,d,m,t[h+14],17,-1502002290),d=i(d,m=a(m,g,p,d,t[h+15],22,1236535329),g,p,t[h+1],5,-165796510),p=i(p,d,m,g,t[h+6],9,-1069501632),g=i(g,p,d,m,t[h+11],14,643717713),m=i(m,g,p,d,t[h],20,-373897302),d=i(d,m,g,p,t[h+5],5,-701558691),p=i(p,d,m,g,t[h+10],9,38016083),g=i(g,p,d,m,t[h+15],14,-660478335),m=i(m,g,p,d,t[h+4],20,-405537848),d=i(d,m,g,p,t[h+9],5,568446438),p=i(p,d,m,g,t[h+14],9,-1019803690),g=i(g,p,d,m,t[h+3],14,-187363961),m=i(m,g,p,d,t[h+8],20,1163531501),d=i(d,m,g,p,t[h+13],5,-1444681467),p=i(p,d,m,g,t[h+2],9,-51403784),g=i(g,p,d,m,t[h+7],14,1735328473),d=r(d,m=i(m,g,p,d,t[h+12],20,-1926607734),g,p,t[h+5],4,-378558),p=r(p,d,m,g,t[h+8],11,-2022574463),g=r(g,p,d,m,t[h+11],16,1839030562),m=r(m,g,p,d,t[h+14],23,-35309556),d=r(d,m,g,p,t[h+1],4,-1530992060),p=r(p,d,m,g,t[h+4],11,1272893353),g=r(g,p,d,m,t[h+7],16,-155497632),m=r(m,g,p,d,t[h+10],23,-1094730640),d=r(d,m,g,p,t[h+13],4,681279174),p=r(p,d,m,g,t[h],11,-358537222),g=r(g,p,d,m,t[h+3],16,-722521979),m=r(m,g,p,d,t[h+6],23,76029189),d=r(d,m,g,p,t[h+9],4,-640364487),p=r(p,d,m,g,t[h+12],11,-421815835),g=r(g,p,d,m,t[h+15],16,530742520),d=o(d,m=r(m,g,p,d,t[h+2],23,-995338651),g,p,t[h],6,-198630844),p=o(p,d,m,g,t[h+7],10,1126891415),g=o(g,p,d,m,t[h+14],15,-1416354905),m=o(m,g,p,d,t[h+5],21,-57434055),d=o(d,m,g,p,t[h+12],6,1700485571),p=o(p,d,m,g,t[h+3],10,-1894986606),g=o(g,p,d,m,t[h+10],15,-1051523),m=o(m,g,p,d,t[h+1],21,-2054922799),d=o(d,m,g,p,t[h+8],6,1873313359),p=o(p,d,m,g,t[h+15],10,-30611744),g=o(g,p,d,m,t[h+6],15,-1560198380),m=o(m,g,p,d,t[h+13],21,1309151649),d=o(d,m,g,p,t[h+4],6,-145523070),p=o(p,d,m,g,t[h+11],10,-1120210379),g=o(g,p,d,m,t[h+2],15,718787259),m=o(m,g,p,d,t[h+9],21,-343485551),d=e(d,s),m=e(m,l),g=e(g,c),p=e(p,u);return[d,m,g,p]}function l(t){for(var e="",n=32*t.length,a=0;a<n;a+=8)e+=String.fromCharCode(t[a>>5]>>>a%32&255);return e}function c(t){var e=[];for(e[(t.length>>2)-1]=void 0,a=0;a<e.length;a+=1)e[a]=0;for(var n=8*t.length,a=0;a<n;a+=8)e[a>>5]|=(255&t.charCodeAt(a/8))<<a%32;return e}function u(t){for(var e,n="0123456789abcdef",a="",i=0;i<t.length;i+=1)e=t.charCodeAt(i),a+=n.charAt(e>>>4&15)+n.charAt(15&e);return a}function d(t){return unescape(encodeURIComponent(t))}function m(t){return l(s(c(e=d(t)),8*e.length));var e}return u(m(t))}async httpGet(t,e=!0,n=!1){let a=null;const i=this.md5(t);if(n&&Keychain.contains(i)){let t=Keychain.get(i);return e?JSON.parse(t):t}try{let n=new Request(t);a=await(e?n.loadJSON():n.loadString())}catch(t){}if(!a&&Keychain.contains(i)){let t=Keychain.get(i);return e?JSON.parse(t):t}return Keychain.set(i,e?JSON.stringify(a):a),a}async httpPost(t,e){}async getImageByUrl(t,e=!0){const n=this.md5(t),a=FileManager.local().joinPath(FileManager.local().temporaryDirectory(),n);if(e&&FileManager.local().fileExists(a))return Image.fromFile(a);try{const e=new Request(t),n=await e.loadImage();return FileManager.local().writeImage(a,n),n}catch(t){let e=new DrawContext;return e.size=new Size(100,100),e.setFillColor(Color.red()),e.fillRect(new Rect(0,0,100,100)),await e.getImage()}}async renderHeader(t,e,n,a=null){t.addSpacer(10);let i=t.addStack();i.centerAlignContent();let r=i.addImage(await this.getImageByUrl(e));r.imageSize=new Size(14,14),r.cornerRadius=4,i.addSpacer(10);let o=i.addText(n);return a&&(o.textColor=a),o.textOpacity=.7,o.font=Font.boldSystemFont(12),t.addSpacer(10),t}async getWidgetScreenShot(t=null){async function e(t,e){let n=new Alert;n.message=t;for(const t of e)n.addAction(t);return await n.presentAlert()}var n;if(n=t||"å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆå‰å¾€æ¡Œé¢,æˆªå–ç©ºç™½ç•Œé¢çš„æˆªå›¾ã€‚ç„¶åå›æ¥ç»§ç»­",await e(n,["æˆ‘å·²æˆªå›¾","å‰å»æˆªå›¾ >"]))return;let a=await Photos.fromLibrary(),i=a.size.height,r={2532:{small:474,medium:1014,large:1062,left:78,right:618,top:231,middle:819,bottom:1407},2688:{small:507,medium:1080,large:1137,left:81,right:654,top:228,middle:858,bottom:1488},1792:{small:338,medium:720,large:758,left:54,right:436,top:160,middle:580,bottom:1e3},2436:{small:465,medium:987,large:1035,left:69,right:591,top:213,middle:783,bottom:1353},2208:{small:471,medium:1044,large:1071,left:99,right:672,top:114,middle:696,bottom:1278},1334:{small:296,medium:642,large:648,left:54,right:400,top:60,middle:412,bottom:764},1136:{small:282,medium:584,large:622,left:30,right:332,top:59,middle:399,bottom:399},1624:{small:310,medium:658,large:690,left:46,right:394,top:142,middle:522,bottom:902},2001:{small:444,medium:963,large:972,left:81,right:600,top:90,middle:618,bottom:1146}}[i];if(!r)return n="å¥½åƒæ‚¨é€‰æ‹©çš„ç…§ç‰‡ä¸æ˜¯æ­£ç¡®çš„æˆªå›¾ï¼Œæˆ–è€…æ‚¨çš„æœºå‹æˆ‘ä»¬æš‚æ—¶ä¸æ”¯æŒã€‚ç‚¹å‡»ç¡®å®šå‰å¾€ç¤¾åŒºè®¨è®º",void(0===await e(n,["å¸®åŠ©","å–æ¶ˆ"])&&Safari.openInApp("https://support.qq.com/products/287371",!1));n="æˆªå›¾ä¸­è¦è®¾ç½®é€æ˜èƒŒæ™¯ç»„ä»¶çš„å°ºå¯¸ç±»å‹æ˜¯ï¼Ÿ";let o=["å°å°ºå¯¸","ä¸­å°ºå¯¸","å¤§å°ºå¯¸"],s=o[await e(n,o)];n="è¦è®¾ç½®é€æ˜èƒŒæ™¯çš„å°ç»„ä»¶åœ¨å“ªä¸ªä½ç½®ï¼Ÿ",n+=1136==i?" ï¼ˆå¤‡æ³¨ï¼šå½“å‰è®¾å¤‡åªæ”¯æŒä¸¤è¡Œå°ç»„ä»¶ï¼Œæ‰€ä»¥ä¸‹è¾¹é€‰é¡¹ä¸­çš„ã€Œä¸­é—´ã€å’Œã€Œåº•éƒ¨ã€çš„é€‰é¡¹æ˜¯ä¸€è‡´çš„ï¼‰":"";let l={w:0,h:0,x:0,y:0};if("å°å°ºå¯¸"==s){l.w=r.small,l.h=r.small;let t=["å·¦ä¸Šè§’","å³ä¸Šè§’","ä¸­é—´å·¦","ä¸­é—´å³","å·¦ä¸‹è§’","å³ä¸‹è§’"],a=["Top left","Top right","Middle left","Middle right","Bottom left","Bottom right"][await e(n,t)].toLowerCase().split(" ");l.y=r[a[0]],l.x=r[a[1]]}else if("ä¸­å°ºå¯¸"==s){l.w=r.medium,l.h=r.small,l.x=r.left;let t=["é¡¶éƒ¨","ä¸­é—´","åº•éƒ¨"],a=["Top","Middle","Bottom"][await e(n,t)].toLowerCase();l.y=r[a]}else if("å¤§å°ºå¯¸"==s){l.w=r.medium,l.h=r.large,l.x=r.left;let t=["é¡¶éƒ¨","åº•éƒ¨"],a=await e(n,t);l.y=a?r.middle:r.top}n="éœ€è¦ç»™èƒŒæ™¯å›¾ç‰‡åŠ ä»€ä¹ˆæ˜¾ç¤ºæ•ˆæœï¼Ÿ";let c=await e(n,["é€æ˜","ç™½è‰² æ¨¡ç³Š","é»‘è‰² æ¨¡ç³Š"]);if(c){const t=1===c?"light":"dark";a=await async function(t,e){const n=`\nvar mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function stackBlurCanvasRGB(id,top_x,top_y,width,height,radius){if(isNaN(radius)||radius<1)return;radius|=0;var canvas=document.getElementById(id);var context=canvas.getContext("2d");var imageData;try{try{imageData=context.getImageData(top_x,top_y,width,height)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imageData=context.getImageData(top_x,top_y,width,height)}catch(e){alert("Cannot access local image");throw new Error("unable to access local image data: "+e);return}}}catch(e){alert("Cannot access image");throw new Error("unable to access image data: "+e);}var pixels=imageData.data;var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,r_out_sum,g_out_sum,b_out_sum,r_in_sum,g_in_sum,b_in_sum,pr,pg,pb,rbs;var div=radius+radius+1;var w4=width<<2;var widthMinus1=width-1;var heightMinus1=height-1;var radiusPlus1=radius+1;var sumFactor=radiusPlus1*(radiusPlus1+1)/2;var stackStart=new BlurStack();var stack=stackStart;for(i=1;i<div;i++){stack=stack.next=new BlurStack();if(i==radiusPlus1)var stackEnd=stack}stack.next=stackStart;var stackIn=null;var stackOut=null;yw=yi=0;var mul_sum=mul_table[radius];var shg_sum=shg_table[radius];for(y=0;y<height;y++){r_in_sum=g_in_sum=b_in_sum=r_sum=g_sum=b_sum=0;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next}for(i=1;i<radiusPlus1;i++){p=yi+((widthMinus1<i?widthMinus1:i)<<2);r_sum+=(stack.r=(pr=pixels[p]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[p+1]))*rbs;b_sum+=(stack.b=(pb=pixels[p+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next}stackIn=stackStart;stackOut=stackEnd;for(x=0;x<width;x++){pixels[yi]=(r_sum*mul_sum)>>shg_sum;pixels[yi+1]=(g_sum*mul_sum)>>shg_sum;pixels[yi+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(yw+((p=x+radius+1)<widthMinus1?p:widthMinus1))<<2;r_in_sum+=(stackIn.r=pixels[p]);g_in_sum+=(stackIn.g=pixels[p+1]);b_in_sum+=(stackIn.b=pixels[p+2]);r_sum+=r_in_sum;g_sum+=g_in_sum;b_sum+=b_in_sum;stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=4}yw+=width}for(x=0;x<width;x++){g_in_sum=b_in_sum=r_in_sum=g_sum=b_sum=r_sum=0;yi=x<<2;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next}yp=width;for(i=1;i<=radius;i++){yi=(yp+x)<<2;r_sum+=(stack.r=(pr=pixels[yi]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[yi+1]))*rbs;b_sum+=(stack.b=(pb=pixels[yi+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;if(i<heightMinus1){yp+=width}}yi=x;stackIn=stackStart;stackOut=stackEnd;for(y=0;y<height;y++){p=yi<<2;pixels[p]=(r_sum*mul_sum)>>shg_sum;pixels[p+1]=(g_sum*mul_sum)>>shg_sum;pixels[p+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(x+(((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width))<<2;r_sum+=(r_in_sum+=(stackIn.r=pixels[p]));g_sum+=(g_in_sum+=(stackIn.g=pixels[p+1]));b_sum+=(b_in_sum+=(stackIn.b=pixels[p+2]));stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=width}}context.putImageData(imageData,top_x,top_y)}function BlurStack(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}\n      // https://gist.github.com/mjackson/5311256\n    \n      function rgbToHsl(r, g, b){\n          r /= 255, g /= 255, b /= 255;\n          var max = Math.max(r, g, b), min = Math.min(r, g, b);\n          var h, s, l = (max + min) / 2;\n    \n          if(max == min){\n              h = s = 0; // achromatic\n          }else{\n              var d = max - min;\n              s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n              switch(max){\n                  case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n                  case g: h = (b - r) / d + 2; break;\n                  case b: h = (r - g) / d + 4; break;\n              }\n              h /= 6;\n          }\n    \n          return [h, s, l];\n      }\n    \n      function hslToRgb(h, s, l){\n          var r, g, b;\n    \n          if(s == 0){\n              r = g = b = l; // achromatic\n          }else{\n              var hue2rgb = function hue2rgb(p, q, t){\n                  if(t < 0) t += 1;\n                  if(t > 1) t -= 1;\n                  if(t < 1/6) return p + (q - p) * 6 * t;\n                  if(t < 1/2) return q;\n                  if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n                  return p;\n              }\n    \n              var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n              var p = 2 * l - q;\n              r = hue2rgb(p, q, h + 1/3);\n              g = hue2rgb(p, q, h);\n              b = hue2rgb(p, q, h - 1/3);\n          }\n    \n          return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\n      }\n      \n      function lightBlur(hsl) {\n      \n        // Adjust the luminance.\n        let lumCalc = 0.35 + (0.3 / hsl[2]);\n        if (lumCalc < 1) { lumCalc = 1; }\n        else if (lumCalc > 3.3) { lumCalc = 3.3; }\n        const l = hsl[2] * lumCalc;\n        \n        // Adjust the saturation. \n        const colorful = 2 * hsl[1] * l;\n        const s = hsl[1] * colorful * 1.5;\n        \n        return [hsl[0],s,l];\n        \n      }\n      \n      function darkBlur(hsl) {\n    \n        // Adjust the saturation. \n        const colorful = 2 * hsl[1] * hsl[2];\n        const s = hsl[1] * (1 - hsl[2]) * 3;\n        \n        return [hsl[0],s,hsl[2]];\n        \n      }\n    \n      // Set up the canvas.\n      const img = document.getElementById("blurImg");\n      const canvas = document.getElementById("mainCanvas");\n    \n      const w = img.naturalWidth;\n      const h = img.naturalHeight;\n    \n      canvas.style.width  = w + "px";\n      canvas.style.height = h + "px";\n      canvas.width = w;\n      canvas.height = h;\n    \n      const context = canvas.getContext("2d");\n      context.clearRect( 0, 0, w, h );\n      context.drawImage( img, 0, 0 );\n      \n      // Get the image data from the context.\n      var imageData = context.getImageData(0,0,w,h);\n      var pix = imageData.data;\n      \n      var isDark = "${e}" == "dark";\n      var imageFunc = isDark ? darkBlur : lightBlur;\n    \n      for (let i=0; i < pix.length; i+=4) {\n    \n        // Convert to HSL.\n        let hsl = rgbToHsl(pix[i],pix[i+1],pix[i+2]);\n        \n        // Apply the image function.\n        hsl = imageFunc(hsl);\n      \n        // Convert back to RGB.\n        const rgb = hslToRgb(hsl[0], hsl[1], hsl[2]);\n      \n        // Put the values back into the data.\n        pix[i] = rgb[0];\n        pix[i+1] = rgb[1];\n        pix[i+2] = rgb[2];\n    \n      }\n    \n      // Draw over the old image.\n      context.putImageData(imageData,0,0);\n    \n      // Blur the image.\n      stackBlurCanvasRGB("mainCanvas", 0, 0, w, h, 150);\n      \n      // Perform the additional processing for dark images.\n      if (isDark) {\n      \n        // Draw the hard light box over it.\n        context.globalCompositeOperation = "hard-light";\n        context.fillStyle = "rgba(55,55,55,0.2)";\n        context.fillRect(0, 0, w, h);\n    \n        // Draw the soft light box over it.\n        context.globalCompositeOperation = "soft-light";\n        context.fillStyle = "rgba(55,55,55,1)";\n        context.fillRect(0, 0, w, h);\n    \n        // Draw the regular box over it.\n        context.globalCompositeOperation = "source-over";\n        context.fillStyle = "rgba(55,55,55,0.4)";\n        context.fillRect(0, 0, w, h);\n      \n      // Otherwise process light images.\n      } else {\n        context.fillStyle = "rgba(255,255,255,0.4)";\n        context.fillRect(0, 0, w, h);\n      }\n    \n      // Return a base64 representation.\n      canvas.toDataURL(); \n      `;let a=`\n      <img id="blurImg" src="data:image/png;base64,${Data.fromPNG(t).toBase64String()}" />\n      <canvas id="mainCanvas" />\n      `,i=new WebView;await i.loadHTML(a);let r=(await i.evaluateJavaScript(n)).slice(22),o=Data.fromBase64String(r);return Image.fromData(o)}(a,t)}return function(t,e){let n=new DrawContext;return n.size=new Size(e.width,e.height),n.drawImageAtPoint(t,new Point(-e.x,-e.y)),n.getImage()}(a,new Rect(l.x,l.y,l.w,l.h))}async notify(t,e,n=null,a={}){let i=new Notification;return i=Object.assign(i,a),i.title=t,i.body=e,n&&(i.openURL=n),await i.schedule()}async shadowImage(t,e="#000000",n=.7){let a=new DrawContext;return a.size=t.size,a.drawImageInRect(t,new Rect(0,0,t.size.width,t.size.height)),a.setFillColor(new Color(e,n)),a.fillRect(new Rect(0,0,t.size.width,t.size.height)),await a.getImage()}loadSettings(){let t=Object.assign({},a.getJSON(this.SETTING_KEY)),e=Object.assign({},this.defaultSettings());for(const n of Object.keys(e))n in t&&(e[n]=t[n]);return console.log(`load settings: ${JSON.stringify(e)}`),e}saveSettings(t){console.log(`save settings: ${JSON.stringify(t)}`),a.setJSON(this.SETTING_KEY,t)}defaultSettings(){}getBackgroundImage(){let t=null;return this.FILE_MGR_LOCAL.fileExists(this.BACKGROUND_KEY)&&(t=Image.fromFile(this.BACKGROUND_KEY)),t}setBackgroundImage(t,e=!0){t?(this.FILE_MGR_LOCAL.writeImage(this.BACKGROUND_KEY,t),e&&this.notify("è®¾ç½®æˆåŠŸ","å°ç»„ä»¶èƒŒæ™¯å›¾ç‰‡å·²è®¾ç½®ï¼ç¨ååˆ·æ–°ç”Ÿæ•ˆ")):(this.FILE_MGR_LOCAL.fileExists(this.BACKGROUND_KEY)&&this.FILE_MGR_LOCAL.remove(this.BACKGROUND_KEY),e&&this.notify("ç§»é™¤æˆåŠŸ","å°ç»„ä»¶èƒŒæ™¯å›¾ç‰‡å·²ç§»é™¤ï¼Œç¨ååˆ·æ–°ç”Ÿæ•ˆ"))}track(t,e){const n=Device.screenResolution();let a;a=config.runsInWidget?`widget.${this.widgetFamily}`:config.runsWithSiri?"siri":config.runsInApp?"app":config.runsInNotification?"notification":config.runsInActionExtension?"actionExtension":config.runsFromHomeScreen?"homeScreen":"unknown";const i={idsite:1,rec:1,action_name:t,url:`https://widget.tornhub.xyz/${a}`,_id:UUID.string().replaceAll("-","").substring(0,16),rand:Math.floor(1e6*Math.random()),apiv:1,res:`${n.width}x${n.height}`};e&&(i.uid=e),this.version&&(i.dimension1=this.version);const r=Object.keys(i).map((t=>`${t}=${encodeURIComponent(i[t])}`)).join("&");new Request(`http://47.117.135.154:8080/matomo.php?${r}`).load()}},Testing:s,Running:o}}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";n.r(a),n.d(a,{run:()=>B});var t=n(27);const e=n(238),{createTableRows:i}=n(418),r="status",o="energy",s="nerve",l="travel",c="drug",u="booster",d="medical",m="bank",g="education",p="oc",h="refills.energy",f="refills.nerve",w="refills.token",_="racing",y={[l]:"airplane",[c]:"pills.fill",[u]:"shift.fill",[d]:"cross.case.fill",[_]:"car.fill"},b={[l]:"é£",[c]:"è¯",[u]:"é…’",[d]:"åŒ»",[_]:"è½¦"},S=Font.regularSystemFont(14),v="#4d7c1e",k="#b3382c",x=Color.dynamic(new Color("#ececec",.5),new Color("#333333",.5));function C(t,e=2){let n=String(t);for(;n.length<e;)n="0"+n;return n}function I(t,e){return new Date(1e3*(t+e))}function $(t){const e={days:Math.floor(t/60/60/24),hours:Math.floor(t/60/60)%24,minutes:Math.floor(t/60)%60};for(const t in e){const n=e[t];if(n>0)return{unit:t,value:n}}}async function D(t,e){const{identifier:n}=t;await Notification.removePending([n]);let a=new Notification;a.openURL="alook://",a.sound="default",a=Object.assign(a,t),a.setTriggerDate(e),await a.schedule()}const R=70,O=148;class M{constructor(t,e,n){this.text=t,this.textColor=e,this.backgroundColor=n}}function A(t,e){const{text:n,textColor:a,backgroundColor:i}=e,r=Font.semiboldSystemFont(14);let o=t.addStack();o.size=new Size(0,16),o.backgroundColor=i,o.cornerRadius=8,o.addSpacer();let s=o.addText(n);return a&&(s.textColor=a),s.lineLimit=1,s.font=r,s.minimumScaleFactor=.8,o.addSpacer(),o}function F(t,e,n,a){for(const i of e){const e=t.addStack();e.size=new Size(t.size.width,0),e.addSpacer(n),A(e,i),e.addSpacer(a)}}class P{constructor(t,e,n){this.date=t,this.symbolName=e,this.glyph=n}}function T(t,e){const n=t.addStack();n.centerAlignContent(),n.addSpacer(4);const{date:a,symbolName:i,glyph:r}=e;if(i){let t=SFSymbol.named(i),e=n.addImage(t.image);const a=10;e.imageSize=new Size(a,a),e.tintColor=Color.dynamic(new Color("#000000",1),new Color("#ffffff",1))}else n.addText(r).font=S;let o=n.addStack().addText(` @ ${C((s=a).getHours())}:${C(s.getMinutes())}`);var s;o.font=S,o.lineLimit=1;let l=n.addStack(),c=l.addText(" in ");c.font=S,c.lineLimit=1;let u=l.addDate(a);return u.font=S,u.lineLimit=1,u.applyTimerStyle(),n}function L(t,e){t.addSpacer();const n=t.addStack();return n.size=new Size(0,e),n.setPadding(0,-8,0,-8),n}function z(t,e){t.addSpacer();const n=t.addStack();return n.size=new Size(e,0),n}function E(t,e){t.addSpacer();const n=t.addStack();return n.size=new Size(e,e),n}class N extends t.Base{constructor(t){super(t),this.name="torn",this.version="0.1.15",this.desc=`ç‰ˆæœ¬ ${this.version}`,this.track("run")}defaultSettings(){return{"notification.travel":!0,"notification.drug":!0,"notification.booster":!0,"notification.medical":!0,"notification.npcloot":!0,"npcloot.duke":!0,"npcloot.leslie":!0,"npcloot.jimmy":!1,"npcloot.fernando":!0,"npcloot.tiny":!0}}track(t,n){const a="PlayerIDKey";n?(e.set(a,n),super.track(t,n)):e.get(a)&&super.track(t,n)}async render(){let t,e,n,a=this.arg;if("string"==typeof a&&a.length>0){const i=`https://api.torn.com/user/?selections=timestamp,basic,travel,cooldowns,bars,money,education,refills,icons&key=${a}&comment=TornWidget`;t=await this.httpGet(i,!0,!1),e=await this.getPIDaysLeft(a),n=await this.getDrugAddictionPoints(a).catch((t=>{console.log(`Get addiction failed. ${t}`)}))}else t={timestamp:1615639666,level:25,gender:"Male",player_id:1,name:"microdust",server_time:1615639666,points:36,cayman_bank:0,vault_amount:0,daily_networth:5379662754,money_onhand:600293,education_current:61,education_timeleft:1545972,status:{description:"Traveling to United Kingdom",details:"",state:"Traveling",color:"blue",until:0},travel:{destination:"United Kingdom",timestamp:1615644140,departed:1615637300,time_left:4474},cooldowns:{drug:27118,medical:17393,booster:13236},happy:{current:4938,maximum:5025,increment:5,interval:900,ticktime:734,fulltime:16034},life:{current:685,maximum:1181,increment:70,interval:300,ticktime:134,fulltime:2234},energy:{current:30,maximum:150,increment:5,interval:600,ticktime:134,fulltime:13934},nerve:{current:15,maximum:61,increment:1,interval:300,ticktime:134,fulltime:13634},chain:{current:0,maximum:1e4,timeout:0,modifier:1,cooldown:0},city_bank:{amount:2436e6,time_left:6732555},education_completed:[14,18,19,20,34,43,44,45,46,47,48,49,50,51,52,54,112,113,126,127],refills:{energy_refill_used:!0,nerve_refill_used:!1,token_refill_used:!1,special_refills_available:0},icons:{icon6:"Male",icon4:"Subscriber - Donator status: 92 days - Subscriber until: 24/08/21",icon8:"Married - To Trefor",icon29:"Bank Investment - Current bank investment worth $3,639,000,000 - 60 days, 23 hours, 34 minutes and 39 seconds",icon27:"Company - Chandler of Lead Farmers (Candle Shop)",icon9:"Faction - Karajan of November Chopin",icon19:"Education - Currently completing the Bachelor of Psychological Sciences course - 26 days, 9 hours, 9 minutes and 58 seconds",icon38:"Stock Market - You own shares in the stock market",icon85:"Organized Crime - Planned Robbery - 3 days, 15 hours, 47 minutes and 0 seconds",icon39:"Booster Cooldown - 01:24:28 / 24:00:00",icon52:"Drug Cooldown - Under the influence of Xanax - 03:03:50 ",icon78:"Property Upkeep war - $21,755,000 is due in property upkeep",icon17:"Racing - Waiting for a race to start - 00:58:29"}},t.timestamp=Math.floor(Date.now()/1e3),e=999;const{player_id:i}=t;i&&this.track("render",i);const r=await this.parseData(t);r.pi=60*e*60*24,n&&(r.dap=n);const o=new ListWidget;switch(this.widgetFamily){case"large":await this.renderLarge(o,r);break;case"medium":await this.renderMedium(o,r);break;default:this.renderSmall(o,r)}return o}renderSmall(t,e){let n=[];switch(e.status){case"Abroad":n.push(new M("abroad",new Color("#ececec",1),Color.blue()));break;case"Traveling":n.push(new M("flying",new Color("#ececec",1),Color.purple()));break;case"Hospital":n.push(new M("hosp",new Color("#ececec",1),Color.red()));break;default:n.push(new M("okay",new Color("#ececec",1),Color.green()))}for(const t of[o,s]){const a={energy:v,nerve:k},i=e[t];n.push(new M(`${i.current}/${i.maximum}`,new Color("#ececec",1),new Color(a[t],1)))}e.dap?n.push(new M(`${e.dap}`,new Color("#ececec",1),new Color("#6cadde",1))):n.push(new M(`refill:${e["refills.energy"]}`,new Color("#ececec",1),new Color("#6cadde",1)));let a=[];for(const t of[m,g,p,"pi"]){if(!e[t])continue;const n={[m]:"ğŸ¦",[g]:"ğŸ“",[p]:"OC ",pi:"PI "};let i,r=$(e[t]);i=r?999===r.value?" âˆ":`${r.value}${r.unit[0]}`:"now",a.push(new M(`${n[t]}${i}`,null,x))}let i=[];const r=[l,_,c,u,d];for(const t of r){if(!e[t])continue;let n=e[t];const a=y[t],r=b[t];i.push(new P(n,a,r))}let h=L(t,R),f=E(h,R),w=E(h,R);h.addSpacer();let S=L(t,R);S.addSpacer();let C=S.addStack();C.size=new Size(O,R),C.cornerRadius=8,C.backgroundColor=x,S.addSpacer(),t.addSpacer(),f.layoutVertically(),f.addSpacer(),F(f,n,3,0),f.addSpacer(),w.layoutVertically(),w.addSpacer(),F(w,a,0,4),w.addSpacer(),C.layoutVertically();for(const t of i)T(C,t)}async renderMedium(t,e){const n=t.addStack(),a=z(n,O);a.layoutVertically();const i=z(n,O);i.layoutVertically(),n.addSpacer(),this.renderSmall(a,e);let r=[];r.push(new M("refills",null,x));for(const t of[h,f,w]){if(void 0===e[t])continue;const n={[h]:"ener",[f]:"nerv",[w]:"toke"};r.push(new M(`${n[t]}:${e[t]}`,null,x))}let o=[];for(let t=0;t<4;t++)o.push(new M("",null,x));const s=await this.httpGet("https://yata.yt/api/v1/loot/",!0,!1),l={4:{name:"DUKE",glyph:"æœ"},15:{name:"Leslie",glyph:"è±"},19:{name:"Jimmy",glyph:"å‰"},20:{name:"Fernando",glyph:"è´¹"},21:{name:"Tiny",glyph:"å°"}};let c=[];for(const t in l){const e=`torn.npc.${t}`;if(this.settings["notification.npcloot"]||await Notification.removePending([e]),!this.settings[`npcloot.${l[t].name.toLowerCase()}`])continue;if(!s||!s.hosp_out||!s.hosp_out[t])continue;const n=new Date(1e3*(s.hosp_out[t]+12600)),a=l[t].glyph;c.push(new P(n,null,a)),this.settings["notification.npcloot"]&&await D({identifier:e,title:"Torn NPC",body:`Loot ${l[t].name} in 5 minutes`,openURL:`alook://www.torn.com/loader2.php?sid=getInAttack&user2ID=${t}`},new Date(n.getTime()-3e5))}let u=L(i,R),d=E(u,R),m=E(u,R);u.addSpacer();let g=L(i,R);g.addSpacer();let p=g.addStack();p.size=new Size(O,R),p.cornerRadius=8,p.backgroundColor=x,g.addSpacer(),i.addSpacer(),d.layoutVertically(),d.addSpacer(),F(d,r,3,0),d.addSpacer(),m.layoutVertically(),m.addSpacer(),F(m,o,0,4),m.addSpacer(),p.layoutVertically();for(const t of c)T(p,t)}async _renderMedium(t,e=[l,c,u,d]){let n=new ListWidget;await this.renderHeader(n,null,"TORN CITY");for(const a of e){if(!t[a])continue;const e=n.addStack();e.centerAlignContent();const i=e.addStack();i.size=new Size(3,15),i.backgroundColor=new Color("#ff837a",.6),e.addSpacer(10);let r=t[a];if("string"==typeof r)e.addText(`${a}: ${r}`).font=S;else if(r instanceof Date){{let t=SFSymbol.named(y[a]),n=e.addImage(t.image);n.imageSize=new Size(14,14),n.tintColor=Color.dynamic(new Color("#000000",1),new Color("#ffffff",1))}e.addText(" @ ").font=S;let t=e.addDate(r);t.font=S,t.applyTimeStyle(),e.addText(" in ").font=S;let n=e.addDate(r);n.font=S,n.applyTimerStyle()}else if("number"==typeof r){let t,n=$(r);switch(a){case m:t=n?`will expire in ${n.value} ${n.unit}`:"has expired";break;case g:t=n?`will end in ${n.value} ${n.unit}`:"has ended";break;case p:t=n?`will be ready in ${n.value} ${n.unit}`:"has been ready"}e.addText(`${a}: ${t}`).font=S}else{const n={energy:v,nerve:k};let i=t[a],r=i.current/i.maximum,o=e.addStack();o.addSpacer(0),o.size=new Size(100,20),o.backgroundColor=new Color("#888888",1);let s=o.addStack();s.size=new Size(o.size.width*r,o.size.height),s.backgroundColor=new Color(n[a],1),o.addSpacer(),e.addSpacer(4);let l=`${i.current}/${i.maximum}`;e.addText(l).font=S}e.addSpacer(),n.addSpacer(8)}const a={"Data@":new Date(1e3*t.timestamp),"Widget@":new Date};let i=n.addStack();i.centerAlignContent();let r=SFSymbol.named("arrow.clockwise"),o=i.addImage(r.image);o.imageSize=new Size(14,14),o.tintColor=Color.dynamic(new Color("#000000",1),new Color("#ffffff",1));for(const t in a){i.addSpacer(4),i.addText(t).font=S;let e=i.addDate(a[t]);e.font=S,e.applyRelativeStyle()}return i.addSpacer(),n.addSpacer(),n.refreshAfterDate=new Date(Date.now()+3e4),n}async renderLarge(t,e){const n=[r,o,s,l,c,u,d,m,g,p];return await this._renderMedium(e,n)}async fetchAPI(t,e){e.comment="TornWidget";let n=`https://api.torn.com/${t}?${Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}`;const a=await this.httpGet(n,!0,!1);if(a.error){let{code:t,error:e}=a.error;throw new Error(`API error ${t} ${e}`)}return a}async getPIDaysLeft(t){const n="PropertyDataKey",a=e.getJSON(n);if(a&&Date.now()-a.timestamp<864e5)return a.days;const i=await this.fetchAPI("property",{selections:"property",key:t});if(!(i&&i.property&&i.property.property_type&&i.property.rented))return void console.warn("invalid property data");const{property_type:r,rented:o}=i.property;let s;return 13===r&&(s="string"==typeof o.days_left?999:o.days_left),e.setJSON(n,{days:s,timestamp:Date.now()}),s}async getDrugAddictionPoints(t){const e=await this.fetchAPI("user",{selections:"log",cat:"61",key:t}).catch((t=>{throw t})),n=Object.values(e.log).sort(((t,e)=>e.timestamp-t.timestamp)),a=n.filter((t=>6005===t.log)),r=n.filter((t=>6005!==t.log));console.log("drug addiction points resolving.");const o=i(a,r);if(!o.length)throw new Error("createTableRows return empty");const{points:s}=o.pop();return console.log(`drug addiction points resolved ${s}`),s}async parseData(t){let{timestamp:e,cooldowns:n,status:a,travel:i}=t,{energy:l,nerve:m,happy:g,life:p,chain:h}=t,{city_bank:f,education_timeleft:w}=t,_={timestamp:e,[r]:a.state,[o]:l,[s]:m};if("Traveling"===a.state){let{destination:t,time_left:n}=i,a=I(e,n);_.travel=a;const r="torn.travel";this.settings["notification.travel"]?await D({identifier:r,title:"Torn Travel",body:`Arriving at ${t}`},new Date(a.getTime()-15e3)):await Notification.removePending([r])}const y=[c,u,d];for(const t of y){if(0===n[t])continue;let a=I(e,n[t]);_[t]=a;const i=`torn.cooldowns.${t}`;this.settings[`notification.${t}`]?await D({identifier:`torn.cooldowns.${t}`,title:"Torn Cooldowns",body:`Here is your ${t} cooldown reminder!`},a):await Notification.removePending([i])}f&&void 0!==f.time_left&&(_.bank=f.time_left),void 0!==w&&(_.education=w);let{refills:b}=t;if(b){const{energy_refill_used:t,nerve_refill_used:e,token_refill_used:n,special_refills_available:a}=b;if(void 0!==t&&void 0!==a){let e=Number(a);t||(e+=1),_["refills.energy"]=e}void 0!==e&&(_["refills.nerve"]=e?0:1),void 0!==n&&(_["refills.token"]=n?0:1)}let{icons:S}=t;if(S.icon85?_.oc=v(S.icon85):_.oc=0,S.icon17){S.icon17.toLowerCase().indexOf("wait");let t=v(S.icon17);t&&(_.racing=I(e,t))}else S.icon18,_.racing=null;function v(t){let e=t.match(/\d+ \w+/g);if(null!==e&&e.length>0)return e.reduce(((t,e)=>{let n=e.split(" "),a=Number(n[0]),i=n[1];return"days"===i?t+60*a*60*24:"hours"===i?t+60*a*60:"minutes"===i?t+60*a:"seconds"===i?t+a:t}),0);if(e=t.match(/\d{2}:\d{2}:\d{2}/g),null!==e&&e.length>0){let t=e[0].split(":");return 3600*t[0]+60*t[1]+Number(t[2])}return 0}return _}}async function B(){await(0,t.Running)(N)}})(),Scriptable=a})();
await Scriptable.run();